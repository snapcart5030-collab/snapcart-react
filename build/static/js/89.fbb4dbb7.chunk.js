"use strict";(self.webpackChunksmilecheck=self.webpackChunksmilecheck||[]).push([[89],{89:(t,e,o)=>{o.r(e),o.d(e,{default:()=>u});var r=o(43),s=o(352),i=o(407),n=o(346),a=o(722),c=o(339),d=(o(957),o(609)),l=o(579);const h=function(){return(0,l.jsx)("div",{className:"empty_cart_container",children:(0,l.jsxs)("div",{className:"empty_cart_box",children:[(0,l.jsx)("img",{src:"/image/emptycart.jpg",alt:"Empty Cart",className:"empty_cart_img"}),(0,l.jsx)("h2",{children:"Your Cart is Empty"}),(0,l.jsx)("div",{children:"Looks like you haven't added anything to your cart yet. "}),(0,l.jsx)(s.N_,{to:"/",className:"continue_shopping_btn",children:"Continue Shopping"})]})})};const u=function(){const[t]=(0,i.lT)(["token"]),[e,o]=(0,r.useState)([]),u=(0,s.Zp)(),[p,m]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!1),{cartItems:b,fetchCart:y,addToCart:j,removeFromCart:v,setCartItems:I}=(0,n._)();(0,r.useEffect)(()=>{t.token?y():(c.oR.error("Please login first to access the cart.",{position:"top-center"}),u("/login"))},[t,u,y]);const f="cart-toast",N=async e=>{o(t=>[...t,e]);try{await a.A.post((0,d.t8)(),{productId:e},{headers:{Authorization:"Bearer ".concat(t.token)}}),I(t=>t.filter(t=>t.productId!==e)),c.oR.success("Item removed from cart.",{id:f,position:"bottom-right"})}catch(r){console.error(r),c.oR.error("Failed to remove item.",{position:"bottom-right"})}o(t=>t.filter(t=>t!==e))};return t.token?(0,l.jsxs)("div",{className:" container-fluid mt-5",children:[0===b.length?(0,l.jsxs)("div",{children:[" ",(0,l.jsx)(h,{})," "]}):(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("h2",{children:"Your Carts"}),(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Product"}),(0,l.jsx)("th",{children:"Image"}),(0,l.jsx)("th",{children:"Price"}),(0,l.jsx)("th",{children:"Quantity"}),(0,l.jsx)("th",{children:"Total"}),(0,l.jsx)("th",{children:"Action"})]})}),(0,l.jsx)("tbody",{children:b.map(r=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:r.productName}),(0,l.jsx)("td",{children:(0,l.jsx)("img",{src:r.productImage,alt:r.productName,style:{width:"60px",height:"60px",objectFit:"cover",borderRadius:"8px"}})}),(0,l.jsxs)("td",{children:["\u20b9",r.productPrice]}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"d-flex align-items-center",children:[(0,l.jsx)("button",{onClick:()=>N(r.productId),disabled:e.includes(r.productId),className:"btn btn-sm ".concat(1===r.quantity?"btn-danger":"btn-secondary"),children:1===r.quantity?"\ud83d\uddd1":"-"}),(0,l.jsx)("span",{className:"mx-2",children:e.includes(r.productId)?(0,l.jsx)("span",{className:"spinner-border spinner-border-sm"}):r.quantity}),(0,l.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:()=>(async(e,r)=>{o(t=>[...t,e]);try{await a.A.post((0,d.d8)(),{productId:e,quantity:1},{headers:{Authorization:"Bearer ".concat(t.token)}}),y(),c.oR.dismiss(f),c.oR.success("".concat(r||"Item"," quantity increased!"),{id:f,position:"bottom-right"})}catch(s){console.error(s),c.oR.dismiss(f),c.oR.error("Failed to increase quantity.",{id:f,position:"bottom-right"})}o(t=>t.filter(t=>t!==e))})(r.productId),disabled:e.includes(r.productId),children:"+"})]})}),(0,l.jsxs)("td",{children:["\u20b9",r.productPrice*r.quantity]}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn btn-sm btn-danger",onClick:()=>N(r.productId),disabled:e.includes(r.productId),children:"Remove"})})]},r.productId))})]}),b.length>0&&(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsxs)("button",{style:{background:"#00b761"},className:"btn text-light ",onClick:async()=>{if("getBattery"in navigator){if((await navigator.getBattery()).level<=.2)return m(!0),x(!0),c.oR.error("Battery < 20% \u2014 please charge your phone",{position:"top-center"}),void u("/batery");m(!1),x(!1)}return b.length<3?c.oR.error("Please add at least 3 items before Ordering.",{position:"top-center"}):"geolocation"in navigator?(c.oR.loading("Fetching your location...",{position:"top-center"}),void navigator.geolocation.getCurrentPosition(async e=>{c.oR.dismiss();const{latitude:o,longitude:r}=e.coords,s="Lat: ".concat(o,", Lng: ").concat(r);try{const e=(await a.A.post("".concat((0,d.CJ)(),"/checkout"),{latitude:o,longitude:r,address:s},{headers:{Authorization:"Bearer ".concat(t.token)}})).data.order;c.oR.success("\u2705 Order placed successfully!",{position:"top-center"}),I([]),await a.A.post((0,d.$U)(),{orderId:e._id,userEmail:e.userEmail}),localStorage.setItem("lastOrderId",e._id),u("/myorders")}catch(l){var i,n;console.error(l),c.oR.error((null===(i=l.response)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.msg)||"Failed to place order.",{position:"bottom-right"})}},t=>{c.oR.dismiss(),t.code===t.PERMISSION_DENIED?c.oR.error("Please allow location access before placing the order.",{position:"top-center"}):c.oR.error("Unable to fetch location. Please try again.",{position:"top-center"})})):c.oR.error("Geolocation is not supported in your browser.",{position:"top-center"})},children:["Order Now ",(0,l.jsx)("span",{className:"text-light fw-bold",children:b.length})," items"]})})]}):null}}}]);
//# sourceMappingURL=89.fbb4dbb7.chunk.js.map