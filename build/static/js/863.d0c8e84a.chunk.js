"use strict";(self.webpackChunksmilecheck=self.webpackChunksmilecheck||[]).push([[863],{660:(e,s,a)=>{a.d(s,{O1:()=>r,sZ:()=>t,tC:()=>n});const t=(0,a(104).io)("https://snapcart-usja.onrender.com",{transports:["websocket","polling"]}),r=e=>{e&&(t.emit("register",e),console.log("\ud83d\udfe2 Registered socket for:",e))},n=e=>{e&&(t.emit("unregister",e),console.log("\ud83d\udd34 Unregistered socket for:",e))}},863:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(339),r=a(43),n=a(722),i=a(6),c=a(660),o=a(352),l=a(609),m=a(579);const d=function(){const{user:e}=(0,i.A)(),[s,a]=(0,r.useState)([]),[d,g]=(0,r.useState)(""),[u,_]=(0,r.useState)(""),f=(0,r.useRef)(null),h=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e)return;(async()=>{try{const s=await n.A.get("".concat((0,l.Dp)(),"/").concat(e.email));a(s.data||[])}catch(s){console.error("Fetch messages error:",s)}})()},[e]),(0,r.useEffect)(()=>{if(!e)return;c.sZ.emit("register",e.email);const s=s=>{s.sender!==e.email&&a(e=>{if(e.some(e=>e._id===s.contactId&&e.textMessage===s.message))return e;const a=e.findIndex(e=>e._id===s.contactId),t=[...e];return-1!==a?("admin@gmail.com"===s.sender?(t[a].responses=t[a].responses||[],t[a].responses.push({message:s.message})):t[a].textMessage=s.message,t):[...e,{_id:s.contactId||Date.now(),email:s.email,username:s.username||s.sender,textMessage:s.message,responses:"admin@gmail.com"===s.sender?[{message:s.message}]:[]}]})},t=s=>{s.sender!==e.email&&(_("".concat(s.sender," is typing...")),clearTimeout(f.current),f.current=setTimeout(()=>_(""),1500))};return c.sZ.off("receiveMessage"),c.sZ.off("typing"),c.sZ.on("receiveMessage",s),c.sZ.on("typing",t),()=>{c.sZ.off("receiveMessage",s),c.sZ.off("typing",t)}},[e]),(0,r.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollTo(0,h.current.scrollHeight)},[s,u]),(0,m.jsx)("div",{className:"my_contact_wrapper_5",children:(0,m.jsxs)("div",{className:"my_contact_box_5",children:[(0,m.jsxs)("div",{className:"chat_header_5",children:[(0,m.jsx)(o.N_,{to:"/",className:"bi  bi-arrow-left btn chat_back_btn_5"}),(0,m.jsx)("h2",{children:"Contact with Admin"}),(0,m.jsx)("button",{onClick:async()=>{if(e){if(window.confirm("Are you sure you want to delete all your messages?"))try{await n.A.post("".concat((0,l.Dp)(),"/deleteAll"),{email:e.email}),a([]),t.oR.success("All messages deleted!")}catch(s){console.error("Delete all error:",s),t.oR.error("Failed to delete messages.")}}else t.oR.error("Please login first!")},disabled:!e,className:"chat_delete_btn_5 bg-transparent",title:"Delete All",children:(0,m.jsx)("i",{className:"bi btn btn-danger bi-trash-fill"})})]}),(0,m.jsxs)("div",{className:"my_chat_box",ref:h,children:[s.map(s=>{var a;return(0,m.jsxs)("div",{className:"chat_message_5 ".concat(s.email===(null===e||void 0===e?void 0:e.email)?"user_msg_5":"admin_msg_5"),children:[(0,m.jsxs)("p",{children:[(0,m.jsxs)("strong",{className:"text-primary fw-bold",children:[s.username||"You",":"]})," ",(0,m.jsx)("span",{className:"text-danger",children:s.textMessage})]}),null===(a=s.responses)||void 0===a?void 0:a.map((e,s)=>(0,m.jsxs)("p",{className:"admin_response_5 ms-4",children:[(0,m.jsx)("strong",{children:"Admin:"})," ",(0,m.jsx)("span",{className:"text-success",children:e.message})]},s))]},s._id)}),u&&(0,m.jsx)("p",{className:"typing_indicator_5",children:u})]}),(0,m.jsx)("textarea",{value:d,onChange:s=>{e?(g(s.target.value),c.sZ.emit("typing",{sender:e.email,receiver:"admin@gmail.com"})):t.oR.error("Please login first to type a message!")},placeholder:"Write message...",rows:3,className:"my_contact_textarea_5"}),(0,m.jsx)("button",{onClick:async()=>{if(e){if(d.trim())try{const s=(await n.A.post((0,l.Dp)(),{username:e.username,email:e.email,textMessage:d})).data.data;a(e=>[...e,s]),c.sZ.emit("sendMessage",{sender:e.email,receiver:"admin@gmail.com",message:d,contactId:s._id,username:e.username,email:e.email}),g("")}catch(s){console.error("Send message error:",s),t.oR.error("Failed to send message. Try again later.")}}else t.oR.error("Please login first to send messages!")},className:"my_contact_msg_button_5",children:"Send Message"})]})})}}}]);
//# sourceMappingURL=863.d0c8e84a.chunk.js.map