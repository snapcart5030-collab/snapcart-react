{"version":3,"file":"static/js/157.7da55fcb.chunk.js","mappings":"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","sources":["components/LoginPage.jsx","components/socket.js"],"sourcesContent":["import { useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"./AuthProvider\";\r\nimport \"./LoginPage.css\";\r\nimport { Login_Url } from \"./Api_URL_Page\";\r\nimport { registerUserSocket } from \"./socket\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nfunction LoginPage() {\r\n  const [formData, setFormData] = useState({ email: \"\", password: \"\" });\r\n  const [loading, setLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n  const { login } = useAuth();\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({ ...formData, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  // ✅ Get location (lat/lon + address via OpenStreetMap)\r\n  const getLocation = () =>\r\n    new Promise((resolve) => {\r\n      if (!navigator.geolocation) {\r\n        resolve({ latitude: null, longitude: null, address: null });\r\n        return;\r\n      }\r\n\r\n      navigator.geolocation.getCurrentPosition(\r\n        async (pos) => {\r\n          const latitude = pos.coords.latitude;\r\n          const longitude = pos.coords.longitude;\r\n\r\n          let address = null;\r\n          try {\r\n            const resp = await fetch(\r\n              `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`\r\n            );\r\n            const data = await resp.json();\r\n            address = data.display_name || null;\r\n          } catch (error) {\r\n            console.warn(\"Reverse geocoding failed:\", error);\r\n          }\r\n\r\n          resolve({ latitude, longitude, address });\r\n        },\r\n        (err) => {\r\n          console.warn(\"Geolocation denied or failed:\", err);\r\n          resolve({ latitude: null, longitude: null, address: null });\r\n        },\r\n        { enableHighAccuracy: true, timeout: 8000 }\r\n      );\r\n    });\r\n\r\n  // ✅ Handle form submit\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      let location = { latitude: null, longitude: null, address: null };\r\n\r\n      // ✅ Ask user for location via toast instead of window.confirm\r\n      const allowLocation = await new Promise((resolve) => {\r\n        toast((t) => (\r\n          <div className=\"\">\r\n            <span>Allow location access to improve your experience?</span>\r\n            <div className=\"d-flex justify-content-around \">\r\n              <button\r\n                onClick={() => {\r\n                  toast.dismiss(t.id);\r\n                  resolve(true);\r\n                }}\r\n                className=\"btn btn-sm btn-primary\"\r\n              >\r\n                Yes\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  toast.dismiss(t.id);\r\n                  resolve(false);\r\n                }}\r\n                className=\"btn btn-sm btn-secondary\"\r\n              >\r\n                No\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ));\r\n      });\r\n\r\n      if (allowLocation) {\r\n        location = await getLocation();\r\n      } else {\r\n        toast(\"You skipped location access.\", { duration: 1500 });\r\n      }\r\n\r\n      const payload = {\r\n        email: formData.email,\r\n        password: formData.password,\r\n        latitude: location.latitude,\r\n        longitude: location.longitude,\r\n        address: location.address,\r\n      };\r\n\r\n\r\n      const res = await axios.post(Login_Url(), payload);\r\n      const { token, user: userData } = res.data;\r\n\r\n      login(userData, token);\r\n      registerUserSocket(userData.email);\r\n\r\n      toast.success(\"✅ Login successful!\", { duration: 1000, position: \"top-center\" });\r\n\r\n      setTimeout(() => navigate(\"/\"), 500);\r\n    } catch (err) {\r\n      console.error(\"Login error:\", err);\r\n      toast.error(err.response?.data?.msg || \"❌ Login failed. Try again.\", { duration: 2500 });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div className=\"login_container_7\">\r\n\r\n\r\n      <div className=\"login_card_7\">\r\n        <div className=\"d-flex justify-content-between\">\r\n          <Link to={'/'} className=\"bi fs-2 bi-arrow-left\"></Link>\r\n          <h2 className=\"login_title_7 bi bi-person-circle\">   Login</h2>\r\n          <div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"login_form_7\">\r\n          <div className=\"login_input_group_7\">\r\n            <label className=\"login_label_7\">Email</label>\r\n            <input\r\n              type=\"email\"\r\n              placeholder=\"Enter email\"\r\n              className=\"login_input_7\"\r\n              name=\"email\"\r\n              value={formData.email}\r\n              onChange={handleChange}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"login_input_group_7\">\r\n            <label className=\"login_label_7\">Password</label>\r\n            <input\r\n              type=\"password\"\r\n              placeholder=\"Enter password\"\r\n              className=\"login_input_7\"\r\n              name=\"password\"\r\n              value={formData.password}\r\n              onChange={handleChange}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <button id=\"user_login_button_7\" type=\"submit\" disabled={loading}>\r\n            {loading ? \"Logging in...\" : \"Login (auto location)\"}\r\n          </button>\r\n        </form>\r\n        <div className=\"link_register_go\">\r\n          <Link to={\"/register\"}>Register</Link>\r\n          <div className=\"Link_home_go\">\r\n\r\n            <Link to={'/'}>Home</Link>\r\n          </div>\r\n        </div>\r\n          <hr />\r\n        <div className=\"login_info_box_7\">\r\n          <span> Use your registered email and password to log in.</span>\r\n          <div > Don’t have an account ? <Link className=\"text-dark\" to=\"/register\">Register here</Link>.</div>\r\n        </div>\r\n\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoginPage;\r\n","import { io } from \"socket.io-client\";\r\n\r\nexport const socket = io(\"https://snapcart-usja.onrender.com\", {\r\n  transports: [\"websocket\", \"polling\"],\r\n});\r\n\r\n// ✅ Register user after login\r\nexport const registerUserSocket = (userEmail) => {\r\n  if (userEmail) {\r\n    socket.emit(\"register\", userEmail);\r\n    console.log(\"🟢 Registered socket for:\", userEmail);\r\n  }\r\n};\r\n\r\n// ✅ Unregister user on logout\r\nexport const unregisterUserSocket = (userEmail) => {\r\n  if (userEmail) {\r\n    socket.emit(\"unregister\", userEmail);\r\n    console.log(\"🔴 Unregistered socket for:\", userEmail);\r\n  }\r\n};\r\n"],"names":["formData","setFormData","useState","email","password","loading","setLoading","navigate","useNavigate","login","useAuth","handleChange","e","_objectSpread","target","name","value","_jsx","className","children","_jsxs","Link","to","onSubmit","async","preventDefault","location","latitude","longitude","address","Promise","resolve","toast","t","onClick","dismiss","id","navigator","geolocation","getCurrentPosition","pos","coords","resp","fetch","concat","json","display_name","error","console","warn","err","enableHighAccuracy","timeout","duration","payload","res","axios","post","Login_Url","token","user","userData","data","registerUserSocket","success","position","setTimeout","_err$response","_err$response$data","response","msg","type","placeholder","onChange","required","disabled","socket","io","transports","userEmail","emit","log","unregisterUserSocket"],"sourceRoot":""}